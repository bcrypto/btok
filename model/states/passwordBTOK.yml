statechart:
  name: BTOK passwords
  preamble: pin_count = 3;pin_state = 'A'
  root state:
    initial: input
    name: password
    states:
    - name: input
      transitions:
      - event: pin_ok
        guard: pin_state == 'A'
        target: correctPassword
      - guard: pin_state == 'B'
        target: blockedPin
      - event: pin_wrong
        guard: pin_state == 'A'
        target: wrongPasswordCompound
    - name: correctPassword
      on entry: pin_count = 3
      type: final
    - name: blockedPin
    - name: wrongPasswordCompound
      states:
      - name: wrongPasswordState
        on entry: pin_count = pin_count - 1
        transitions:
        - guard: pin_count > 1
          target: input
        - guard: pin_count == 1
          target: inputCan
        - action: puk_count = 10
          guard: pin_count == 0
          target: inputPuk
      - name: inputCan
        transitions:
        - event: wrong_can
          target: inputCan
        - event: correct_can
          target: input
      - name: inputPuk
        transitions:
        - action: pin_count = 3
          event: correct_puk
          target: input
        - action: puk_count = puk_count - 1
          event: wrong_puk
          guard: puk_count > 0
          target: inputPuk
        - action: pin_state = 'B'
          event: wrong_puk
          guard: puk_count == 0
          target: input
      transitions:
      - target: wrongPasswordState
