\section{Объекты}\label{OBJ}

\subsection{Случайные и псевдослучайные числа}\label{OBJ.RNG}

КТ должен поддерживать генерацию случайных или псевдослучайных чисел, 
используемых в криптографических алгоритмах и протоколах, реализованных на 
КТ. 

В криптографических алгоритмах и протоколах рекомендуется использовать 
случайные числа. Однако, если на КТ отсутствует генератор случайных чисел, 
то должен использоваться алгоритмы генерации псевдослучайных чисел, 
определенные в СТБ 34.101.47.

\subsection{Дата}\label{OBJ.Date}

Для определения даты на КТ может быть установлен аппаратный таймер, либо, 
если аппаратного таймера нет, дата может приближенно оцениваться по 
реквизитам входящих сертификатов или по другим данным, передаваемым на КТ 
от терминала. Первоначальная дата устанавливается при выпуске КТ в обращение и 
совпадает с датой выпуска. Если установленная дата предшествует оцененной, 
то она должна быть обновлена с учетом проведенной оценки. 

Дата представляется 8 байтами в формате YYMMDD. Здесь YY означает год 
20YY, MM~--- месяц, DD~--- день. Каждый октет кодирует цифру от 0 до 9. 

\subsection{Пароли}\label{OBJ.PWD}

Для того чтобы владелец КТ мог контролировать доступ к прикладным 
программам и их данным, используются пароли. КТ должен поддерживать пароли 
следующих типов: 

\begin{enumerate}
\item 
PIN (от Personal Identification Number)~--- 
число из 6 десятичных цифр, которое генерируется случайным образом и 
которое известно лишь владельцу КТ; 

\item 
CAN (от Card Access Number)~--- число из 6 десятичных цифр, 
которое не может быть вычислено на основании информации о КТ 
(например, серийном номере) или владельце КТ. Пароль CAN может быть 
напечатан на корпусе КТ или указан в сопроводительных документах; 

\item 
PUK (от PIN Unlock Key)~--– число из 10 десятичных цифр, 
которое генерируется случайным образом и которое известно лишь 
владельцу КТ. 
\end{enumerate}

Пароли используются в протоколе BPACE (см.~\ref{CRYPTO.BPACE})
и являются общими для всех прикладных программ КТ.

\subsection{Пароль PIN}\label{OBJ.PIN}

PIN используется для получения доступа к сервисам и данным прикладных 
программ КТ. 

%\doubt{Для каждой прикладной программы КТ может быть установлен свой 
%собственный PIN.}  

PIN снабжается счетчиком попыток, который первоначально равен 3. При 
неверном вводе PIN счетчик уменьшается на 1. Если счетчик достигает 
значения 1, то PIN приостанавливается и требуется ввод CAN. Ввод CAN не 
изменяет значение счетчика попыток. При верном вводе CAN производится 
возобновление PIN, а при неверном~--- доступ к КТ блокируется на 1 секунду.
Если счетчик попыток достигает значения 0, то PIN 
блокируется. PIN может быть разблокирован вводом верного PUK. При 
разблокировке PIN значение счетчика попыток устанавли-вается в 
первоначальное. После ввода верного PIN он может быть изменен. Если при 
заблокированном PIN делается 10 вводов неверного PUK, то PIN блокируется 
навсегда. 

PIN может быть деактивирован и повторно активирован.
Первоначально PIN является активированным. При деактивации
PIN доступ к сервисам и данным, требующим аутентификации 
по паролю PIN, невозможен.

\subsection{Пароль CAN}\label{OBJ.CAN}

CAN является паролем, который не 
может быть заблокирован или изменен. Он используется для защиты от атак 
типа <<отказ в обслуживании>>: защита состоит в требовании ввести CAN перед 
последней проверкой PIN. Дополнительно CAN может использоваться для 
получения доступа к функциям и данным прикладной программы eID 
авторизованным терминалом, т.~е. терминалом, который был успешно 
аутентифицирован с помощью протокола BAUTH (см.~\ref{CRYPTO.BAUTH}) и в 
сертификате которого установлено соответствующее право (см.~\ref{DATA.Access}). 

\subsection{Пароль PUK}\label{OBJ.PUK}

PUK является паролем, который не может быть заблокирован или изменен. 
Он используется для разблокировки 
PIN. Дополнительно PUK может использоваться для деактивации и активации PIN. 

\subsection{Сертификаты}\label{OBJ.Certs}

При выпуске КТ в обращение на него обязательно записываются сертификат 
ЦИ и сертификат КТ. 
Сертификаты не связаны с конкретной 
прикладной программой, они относятся ко всему КТ. 

Дополнительно, при иcпользовании КТ на него могут быть записаны
сертификаты владельца, которые соответствуют личным ключам, используемым
в прикладной программе eSign для выработки подписи и разбора токена ключа.

% todo: Нужен ли сертификат УЦ записывать?

Формат сертификатов и правила управления ими описаны в~\ref{CERTS}.

\subsection{Прикладная программа eID}\label{OBJ.eID}

Прикладная программа eID обеспечивает управление атрибутами владельца КТ 
(см.~\ref{DATA}). Доступ к атрибутам 
осуществляется только после успешной аутентификации терминала. Атрибуты 
передаются по защищенному соединению в соответствии с разрешениями, 
установленными владельцем КТ, и правами, заданными в маршруте сертификации 
терминала (см.~\ref{CERTS.Path}).  

Данные eID хранятся на КТ в элементарных файлах, описанных в~приложении~\ref{FILES}.

Прикладная программа eID при аутентификации КТ перед терминалом использует личный 
ключ, который соответствует открытому ключу из сертификата КТ. 
Личный ключ устанавливается (или генерируется) при выпуске КТ и никому не 
известен. К личному ключу можно обратиться только неявно, он не может быть 
прочитан с КТ или изменен. 

Прикладной программе eID назначается идентификатор \verb|id-eID|, 
определенный в приложении~\ref{ASN}. 

\subsection{Прикладная программа eSign}\label{OBJ.eSign}

Прикладная программа eSign обеспечивает генерацию личных и открытых 
ключей, управление сертификатами, выработку подписи и разбор токена ключа.
Для генерации ключей, выработки подписи и разбора токена ключа
применяются алгоритмы СТБ 34.101.45 со стандартными параметрами.

Прикладная программа eSign может использоваться 
в локальном режиме после успешной аутентификации владельца.
Дополнительно, прикладная программа eSign может использоваться 
в терминальном режиме после успешной аутентификации терминала.

Прикладная программа eSign поддерживает одновременное 
использование нескольких личных ключей, 
которые могут применяться при выработке подписи и разборе токена ключа.
Личные ключи генерируются средствами КТ и никому не известны. 
К личному ключу можно обратиться только по ссылке, 
он не может быть прочитан с КТ. 
Ключи, сгенерированные в локальном режиме, не могут использоваться 
в терминальном и наоборот.

Для каждого личного ключа после его генерации в КТ может быть установлен 
соответствующий ему сертификат. 
При формирования запроса на выпуск сертификата могут использоваться
данные eSign, специально для этого предназначенные и предварительно
установленные при выпуске или эксплуатации КТ.

Cертификаты владельца и данные для запроса на выпуск сертификата
прикладной программы eSign хранятся на 
КТ в элементарных файлах, описанных в~приложении~\ref{FILES}.

Прикладной программе eSign назначается идентификатор \verb|id-eSign|, 
определенный в приложении~\ref{ASN}. 

