\chapter{Идентификационные данные}\label{DATA}

\section{Группы данных}\label{DATA.DG}

Информация о КТ и идентификационные атрибуты владельца КТ организованы в 
виде групп данных, которые нумеруются DG1, DG2,\ldots, DG22. 
Наименование, содержание и обязательность групп данных определяются в 
таблице~\ref{Table.DATA.DG}. 
%
Непосредственно идентификационные атрибуты владельца КТ располагаются 
в группах DG4 -- DG12, DG17, DG18, DG21, DG22. 
Группы DG13, DG19, DG20 зарезервированы для будущего 
применения, в настоящем стандарте они не определяются. 

\begin{table}[h!]
\caption{Группы данных}\label{Table.DATA.DG}
\begin{tabular}{|c|c|c|c|}
\hline
Группа & Наименование & Содержание & Обязательность\\
\hline
\hline
DG1 &	SerialNumber &	Серийный номер КТ  & +  \\
\hline
DG2 &	IssuingState &	Страна, выпустившая КТ & + \\
\hline
DG3 &	DateOfExpiry &	Дата окончания действия КТ & +  \\
\hline
DG4 &	GivenName   &	Имя & + \\
\hline
DG5 &	FamilyName &	Фамилия & + \\
\hline
DG6 &	MiddleName &	Отчество & + \\
\hline
DG7 &	PersonalNumber & Личный номер & + \\
\hline
DG8 &	DateOfBirth &	Дата рождения & + \\
\hline
DG9 &	PlaceOfBirth &	Место рождения & + \\
\hline
DG10 & 	Nationality &	Гражданство & +\\
\hline
DG11 &	Sex 	  &  Пол  & + \\
\hline
DG12 &	OptionalDataR & Дополнительные данные для чтения & \\
\hline
%DG13 &  BirthName & ФИО владельца, данное ему при рождении \\
%\hline
DG13 &	--- &   Зарезервировано на будущее &  \\
\hline
DG14 &  WrittenSignature & Изображение ручной подписи & \\
\hline
DG15 &  DateОfIssuance & Дата выпуска КТ  & + \\
\hline
DG16 &  IssuanceBoard & Орган, выдавший КТ  & + \\
\hline
DG17 &	PlaceOfResidence &   Адрес постоянного места жительства & \\
\hline
DG18 &	DistrictID 	 &   Код региона &  \\
\hline
%DG19 &	ResidencePermitI &	Вид на жительство I  \\
%\hline
%DG20 &	ResidencePermitII& 	Вид на жительство II \\
%\hline
DG19 &	--- &	Зарезервировано на будущее & \\
\hline
DG20 &	--- & 	Зарезервировано на будущее & \\
\hline
DG21 &	PhoneNumber & Номер телефона & \\
\hline
DG22 &	EMailAddress & Адрес электронной почты & \\
\hline
\end{tabular}
\end{table}
                         
Группы данных описываются следующими одноименными типами АСН.1.
В типах применяется неявное (\texttt{IMPLICIT}) тегирование.

\if 0
CommunityID ::= [APPLICATION 18] OCTET STRING
ResidencePermitI ::= [APPLICATION 19] Text
ResidencePermitII ::= [APPLICATION 20] Text

Text ::= CHOICE {
  uncompressed [1] UTF8String
  compressed   [2] OCTET STRING
}
\fi


\begin{verbatim}
SerialNumber ::= [APPLICATION 1] PrintableString(SIZE (7..64))
IssuingState ::= [APPLICATION 2] Country
DateOfExpiry ::= [APPLICATION 3] Date
GivenName ::= [APPLICATION 4] UTF8String
FamilyName ::= [APPLICATION 5] UTF8String
MiddleName ::= [APPLICATION 6] UTF8String
PersonalNumber ::= [APPLICATION 7] PrintableString(SIZE (7..64))
DateOfBirth ::= [APPLICATION 8] Date
PlaceOfBirth ::= [APPLICATION 9] GeneralPlace
Nationality ::= [APPLICATION 10] Country
Sex ::= [APPLICATION 11] ICAOSex
OptionalDataR ::= [APPLICATION 12] SET OF OptionalData
WrittenSignature ::= [APPLICATION 14] OCTET STRING
DateOfIssuance ::= [APPLICATION 15] Date
IssuanceBoard ::= [APPLICATION 16] UTF8String
PlaceOfResidence ::= [APPLICATION 17] GeneralPlace
DistrictID ::= [APPLICATION 18] PrintableString(SIZE (7..64))
PhoneNumber ::= [APPLICATION 21] PrintableString
EmailAddress ::= [APPLICATION 22] IA5String

ICAOString ::= PrintableString (FROM ("A".. "Z" | " "))
Country ::= ICAOString (SIZE (3))
ICAOSex ::= PrintableString (FROM ("M"|"F"|" "))
Date ::= NumericString (SIZE (8))
Place ::= SEQUENCE {
  street  [10] UTF8String OPTIONAL,
  city    [11] UTF8String,
  state   [12] UTF8String OPTIONAL,
  country [13] Country,
  zipcode [14] PrintableString OPTIONAL
}
GeneralPlace ::= CHOICE {
  structuredPlace Place
  freetextPlace   [1] UTF8String
  noPlaceInfo     [2] UTF8String
}
OptionalData ::= SEQUENCE {
  type OBJECT IDENTIFIER,
  data ANY DEFINED BY type OPTIONAL
}
\end{verbatim}

Серийный номер КТ в группе DG1 должен устанавливаться в соответствии с правилами,
заданными в СТБ 34.101.78 для идентификационного атрибута \verb|serialNumber|. 
Cерийный номер должен начинаться с префикса \str{IDCBY}.
Пример: \str{IDCBY-590082394654}.

Код страны в группах DG2 и DG10 должен иметь трехсимвольное обозначение 
согласно~\cite{CountryCodes}. 
Для группы DG2 код страны должен иметь значение \str{BLR}.
В группе DG10 должно задаваться значение, соответствующее
гражданству владельца КТ (значение \str{BLR} для граждан Республики Беларусь), 
и значение \str{XXX}, если владелец КТ не имеет гражданства 
или его граждаство не определено.

Дата окончания действия КТ в группе DG3, дата рождения владельца КТ в группе DG8 
и дата выпуска КТ в группе DG15 должны иметь формат YYYYMMDD 
(4 символа года, 2 символа месяца, 2 символа 
числа месяца). В случае, если дата рождения известна не полностью, 
пропущенные данные помечаются пробелом. Когда необходимо проверить 
возраст владельца КТ, вместо недостающих данных используется наиболее 
поздняя возможная дата (например, 31 декабря указанного года, если 
известен только год рождения). Год рождения в DG8 содержится всегда, даже 
если он в действительности точно не известен (в последнем случае 
указывается приблизительный год рождения). 

Личный номер владельца КТ в группе DG7 должен устанавливаться в соответствии с
правилами, заданными в СТБ 34.101.78 для идентификационного атрибута
\verb|serialNumber|. Личный номер должен начинаться с префикса
\str{PNOXX}, где символы \str{XX} определяют двухсимвольный код страны
согласно~\cite{CountryCodes}, в которой зарегистрирован номер.
Пример: \str{PNOBY-786545091A4PB5}.

Место рождения владельца КТ в группе DG9 и адрес постоянного места жительства
владельца КТ в группе DG17 рекомендуется задавать типом \verb|Place|, 
компоненты которого имеют следующее значение: 
\begin{enumerate}
\item[1)]
компонент \verb|street| должен содержать название улицы (переулка, 
проспекта, площади и т.п.); 
\item[2)]
компонент \verb|city| должен содержать название города (поселка, деревни и т.п.); 
\item[3)]
компонент \verb|state| должен содержать название области (штата, провинции и т.п.);
\item[4)]
компонент \verb|country| должен содержать код страны (см. описание группы DG2);
\item[5)]
компонент \verb|zipcode| должен содержать почтовый индекс владельца КТ.
\end{enumerate}

Для задания адреса в произвольном виде следует воспользоваться компонентом 
\verb|freetextPlace| типа \verb|GeneralPlace|. Если владелец КТ не проживает в 
Республике Беларусь, то в~\verb|GeneralPlace| должен быть выбран компонент 
\verb|noPlaceInfo| со значением \str{Не пражывае ў РБ/Не проживает в РБ}. 
Если информация месте рождения или месте жительства 
КТ не известна, то в \verb|GeneralPlace| 
должен быть выбран компонент \verb|noPlaceInfo| со значением 
\str{Інфармацыя адсутнічае/Информация отсутствует}. 

%\doubt{В группе DG13 должны быть заданы фамилия, имя и 
%отчество (при наличии) владельца КТ, данные ему при рождении.}

В группе DG14 должно быть задано изображение ручной подписи
владельца КТ в кодировке JPEG 2000~\cite{JPEG2000}.

В группе DG16 должна быть указана организация, которая выдает КТ владельцу. 

Код региона в группе DG18 задается строкой, которая содержит (слева направо):
\begin{itemize}
\item[--]
три символа типа кода региона;
\item[--]
два символа кода страны согласно~\cite{CountryCodes}, в которой зарегистрирован 
код региона;
\item[--]
cимвол \str{-}; 
\item[--]
собственно символы кода региона.
\end{itemize}

При использовании настоящего стандарта тип кода региона
должен принимать значение \str{ZIP}, соответствующее
почтовому индексу. Пример полного кода региона: \str{ZIPBY-220045}.

Почтовые индексы, которые указываются в группах DG17 и DG18,
должны совпадать.

\if 0
Код региона в группе DG18 должен состоять из последовательности 
шестнадцатеричных цифр, которая однозначно идентифицирует определенную 
местность. Правила идентификации в настоящем стандарте не рассматриваются. 
Если в группе DG17 отсутствует адрес постоянного места жительства, то 
группа DG18 должна быть пустой. 
\fi


\if 0
Вид на жительство в группах DG19 и DG20 описывается типом \verb|Text|. 
В этом типе компонент \verb|compressed| является результатом сжатия компонента 
\verb|uncompressed|. Для сжатия должен использоваться алгоритм, 
определенный в~\cite{DEFLATE}. 
\fi

Номер телефона владельца КТ в группе DG21 должен быть
представлен в синтаксисе global-number согласно~\cite{RFC3966}. 

В группе DG22 может быть задан адрес электронной почты владельца КТ. 

В группах данных DG4, DG5, DG6, DG9, DG17 информация
представляется на белорусском и русском языках.
Для разделения информации, представленной на разных языках,
должен использоваться символ \str{/}. Например, в DG5 фамилия 
представляется в виде \str{МIЦКЕВIЧ/МИЦКЕВИЧ}.
Если у владельца КТ отсутствует отчество, то группа DG6 должна быть пустой. 

При хранении групп на КТ они должны кодироваться с помощью отличительных 
правил, описанных в СТБ 34.101.19 (приложение Б). 

Доступ на запись к группам DG1~--- DG16 должен быть запрещен.
 
В приложении~\ref{FILES} приводятся идентификаторы файлов, 
в которых группы данных хранятся на КТ.

\section{Дополнительные данные}\label{DATA.Optional}

При аутентификации терминал запрашивает идентификационные атрибуты
владельца КТ. Кроме атрибутов, определенных в~\ref{DATA.DG}, 
перечень может содержать дополнительные атрибуты DocumentValidity, 
AgeVerification и PlaceVerification. Дополнительным атрибутам назначаются 
идентификаторы, заданные в приложении~\ref{ASN}. 

Атрибут DocumentValidity используется для проверки срока действия КТ. 
Параметром атрибута является дата, на которую необходимо провести 
проверку. Проверка состоит в сравнении даты, содержащейся в группе DG3, с 
датой, указанной в запросе аутентификации. Результат проверки будет 
положительным, если дата в группе DG3 более поздняя. Значением атрибута 
является результат проверки. 

Проверка срока действия КТ должна выполняться всегда и должна предшествовать 
запросу любых других атрибутов. 

Атрибут AgeVerification используется для проверки возраста владельца КТ. 
Параметром атрибута является самая поздняя допустимая дата рождения. 
Проверка состоит в сравнении даты в группе DG8 с датой, указанной в запросе 
аутентификации. Значением атрибута является признак того, что владелец КТ 
родился до указанной в запросе даты. 

Атрибут PlaceVerification используется для проверки проживания владельца 
КТ в определенном регионе. Параметром атрибута является код региона или 
его часть. Проверка состоит в сравнении кода региона, указанного в группе 
DG18, со значением, указанным в параметре. Значением атрибута является 
результат проверки. 

Параметры дополнительных атрибутов должны передаваться КТ в формате, 
заданном следующим типом АСН.1: 

\begin{verbatim}
AuthAuxData ::= [APPLICATION 7] SEQUENCE of DiscretionaryDataTemplate;

DiscretionaryDataTemplate ::= [APPLICATION 19] SEQUENCE {
  objIdentifier  OBJECT IDENTIFIER,
  dataObjects    ANY DEFINED BY objIdentifier
}
\end{verbatim}

Компонент \verb|objIdentifier| задает идентификатор дополнительного атрибута, 
а компонент \verb|dataObjects|~--– параметр атрибута. 
Компонент \verb|dataObjects| должен иметь уникальный контекстно-зависимый тег 
[см. ГОСТ 34.974 (таблица 1)]. 
В таблице~\ref{Table.DATA.Optional} указаны допустимые теги и типы 
компонента \verb|dataObjects| для определенных выше дополнительных атрибутов.

\begin{table}[bht]
\caption{Параметры дополнительных атрибутов}\label{Table.DATA.Optional}
\begin{tabular}{|c|c|c|c|}
\hline
Атрибут & Идентификатор & Тег & Тип параметра (АСН.1)\\
\hline
\hline
DocumentValidity  &	\verb|id-DocumentValidity| & $\texttt{83}_{16}$ & 
\verb|Date|\\
\hline                                                
AgeVerification	  & \verb|id-AgeVerification| & $\texttt{88}_{16}$ & 
\verb|Date|\\
\hline                                                
PlaceVerification &	\verb|id-PlaceVerification| & $\texttt{92}_{16}$ & 
\verb|PrintableString(SIZE (7..64))|\\
\hline
\end{tabular}
\end{table}

\section{Права доступа}\label{DATA.Access}

Права доступа к прикладной программе КТ описываются следующим типом АСН.1:
\begin{verbatim}
CertHAT ::= [APPLICATION 76] SEQUENCE {
  objId              OBJECT IDENTIFIER,
  discretionaryData  [APPLICATION 19] OCTET STRING OPTIONAL
}
\end{verbatim}

Компонент \verb|objId| описывает прикладную программу. 
Компонент \verb|discretionaryData| определяет слово прав доступа. 
Битам этого слова соответствуют определенные группы данных, 
дополнительные атрибуты и другие объекты, 
которыми управляет прикладная программа. Соответствие задается для 
конкретной прикладной программы или системы, в которой она применяется. 
Если компонент \verb|discretionaryData| отсутствует, 
то используются максимальные для прикладной программы права доступа. 

Для описания прав доступа к~eID компонент \verb|objId| должен принимать 
значение \verb|id-eIdAccess|, определенное в приложении~\ref{ASN}. 
Компонент \verb|discretionaryData| должен всегда присутствовать и 
должен состоять из 5 октетов.

%\begin{verbatim}
%EIDAccess ::= OCTET STRING(SIZE(2))
%\end{verbatim}

Эти октеты определяет двоичное слово длины~$40$.
Биты слова нумеруются справа налево, начиная с 0. 
Слово определяет права доступа к идентификационным атрибутам после 
аутентификации по PIN.  
%
Слово также определяет право управления самим паролем 
PIN и право доступа к атрибутам по паролю CAN вместо PIN. 
%
Предполагается, что право проверять срок действия КТ 
имеет любая сторона. Поэтому дополнительный атрибут DocumentValidity 
в слове доступа не учитывается. 

В таблице~\ref{Table.DATA.Access} описываются биты слова прав 
доступа к прикладной программе eID. Биты, зарезервированные на будущее, 
должны быть нулевыми.

Например, слово 
$00000000\ 00110011\ 01101111\ 01111011\ 00010000 = \texttt{003С6F5B10}_{16}$ 
определяет права на чтение по паролям PIN и CAN групп данных DG1, DG2, 
DG4~-- DG7, DG9~--- DG12, DG14, DG15, DG17, DG18, DG21, DG22.

\begin{table}[h!]
\caption{Слово прав доступа к прикладной программе eID}
\label{Table.DATA.Access}
\begin{tabular}{|c|p{13.5cm}|}
\hline
Номера битов & Права доступа\\
\hline
\hline
0 & право проверки возраста (атрибут \verb|AgeVerification|)\\
\hline 
1  &  право проверки принадлежности к региону (атрибут \verb|PlaceVerification|)\\
\hline 
2, 3 & зарезервировано на будущее\\
\hline 
4 & право доступа по паролю CAN\\
\hline
5 & право управлять паролем PIN
(активировать, деактивировать, изменять, разблокировать)\\
\hline 
6, 7 & зарезервировано на будущее\\
\hline 
8  &  право на чтение DG1\\
\hline 
\dots &	\dots\\
\hline 
29 &  право на чтение DG22\\
\hline
30, 31 & зарезервировано на будущее\\
\hline 
32 & право записи в DG22\\
\hline
\dots &	\dots  \\
\hline
37 & право записи в DG17\\
\hline 
38, 39 & зарезервировано на будущее\\
\hline                                                                
\end{tabular}
\end{table}
                                                                            
Для описания прав доступа к прикладной программе eSign компонент \verb|objId| 
должен принимать значение \verb|id-eSignAccess|, определенное в 
приложении~\ref{ASN}. Компонент \verb|discretionaryData| должен всегда 
присутствовать и должен состоять из 2 октетов.

%\begin{verbatim}
%ESignAccess ::= OCTET STRING(SIZE(2))
%\end{verbatim}

Эти октеты определяют двоичное слово длины~$16$. 
Биты слова нумеруются справа налево, начиная с 0. 
Слово определяет права доступа к данным и сервисам~eSign
после аутентификации по PIN. Слово также определяет права управления самим 
паролем PIN. 

\begin{note}
Примечание~--- 
Прикладная программа eSign, в отличие от eID, может использоваться и в базовом, 
и в терминальном режимах. Поэтому именно eSign делегированы операции по 
управлению PIN. Соответственно, права управления eSign более детализированы по 
сравнению с eID.
\end{note}

В таблице~\ref{Table.DATA.SMTAccess} описываются биты слова прав доступа
к прикладной программе eSign. Биты, зарезервированные на будущее, 
должны быть нулевыми.

\begin{table}[h!]
\caption{Слово прав доступа к прикладной программе eSign}
\label{Table.DATA.SMTAccess}
\begin{tabular}{|c|p{13.5cm}|}
\hline
Номера битов & Права доступа\\
\hline
\hline
0~-- 5 &  
зарезервировано на будущее\\ 
%
\hline 
6 &
право активировать и деактивировать пароль PIN\\ 
%
\hline 
7 &
право изменять пароль PIN\\ 
%
\hline 
8 &
право разблокировать пароль PIN\\ 
%
\hline 
9 &
право записывать данные для запроса на получение сертификата\\ 
%
\hline 
10 &
право активировать и деактивировать ключи\\ 
%
\hline 
11 &
зарезервировано на будущее\\ 
%
\hline 
12 &
право генерации ключей, записи сертификатов, 
чтения данных для запроса на получение сертификата
в терминальном режиме\\ 
%
\hline 
13 &
право генерации ключей, записи сертификатов, 
чтения данных для запроса на получение сертификата
в базовом режиме\\ 
%
\hline 
14 &
право выработки подписи, разбора токена ключа и чтения сертификатов 
в терминальном режиме\\ 
%
\hline 
15 &
право выработки подписи, разбора токена ключа и чтения сертификатов 
в базовом режиме\\ 
\hline 
\end{tabular}
\end{table}

При парольной аутентификации КП передает КТ объект \texttt{CertHAT},
контролируя дальнейшие возможности по работе с токеном. Передаваемый объект 
никем не заверен, и поэтому КТ ограничивает заданные в нем права до управления 
паролями и работы с eSign в базовом режиме. 

В терминальном режиме КТ получает~\texttt{CertHAT} в сертификате терминала, 
заверенном УЦ. Сертификат УЦ также содержит объект \texttt{CertHAT}.
Слова прав, первоначально введенных КП, терминала и УЦ накладываются 
друг на друга с помощью операции~$\wedge$ (логическое~И). 
КТ переключается на права, полученные в результате наложения.


